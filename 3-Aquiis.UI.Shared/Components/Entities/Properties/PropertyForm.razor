@namespace Aquiis.UI.Shared.Components.Entities.Properties
@using Aquiis.Core.Constants
@using Microsoft.AspNetCore.Components.Forms
@using System.ComponentModel.DataAnnotations

<EditForm Model="@Model" OnValidSubmit="@HandleValidSubmit" FormName="@FormName">
    <DataAnnotationsValidator />
    
    @if (!string.IsNullOrEmpty(ErrorMessage))
    {
        <div class="alert alert-danger" role="alert">
            @ErrorMessage
        </div>
    }

    @if (!string.IsNullOrEmpty(SuccessMessage))
    {
        <div class="alert alert-success" role="alert">
            @SuccessMessage
        </div>
    }

    <div class="row">
        <div class="col-md-12 mb-3">
            <label class="form-label">Address *</label>
            <InputText @bind-Value="Model.Address" class="form-control" placeholder="Enter property address" />
            <ValidationMessage For="() => Model.Address" class="text-danger" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 mb-3">
            <label class="form-label">Unit Number</label>
            <InputText @bind-Value="Model.UnitNumber" class="form-control" placeholder="e.g., Apt 2B, Unit 101" />
            <ValidationMessage For="() => Model.UnitNumber" class="text-danger" />
        </div>
        <div class="col-md-4 mb-3">
            <label class="form-label" for="@Model.ZipCode">Postal Code</label>
            <InputText @bind-Value="Model.ZipCode" class="form-control" placeholder="#####-####" />
            <ValidationMessage For="() => Model.ZipCode" class="text-danger" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-4 mb-3">
            <label class="form-label">City</label>
            <InputText @bind-Value="Model.City" class="form-control" placeholder="City" />
            <ValidationMessage For="() => Model.City" class="text-danger" />
        </div>
        <div class="col-md-4 mb-3">
            <label class="form-label">State</label>
            <InputSelect @bind-Value="Model.State" class="form-select">
                <option value="">Select State</option>
                @foreach (var state in States.StatesArray())
                {
                    <option value="@state.Abbreviation">@state.Name</option>
                }
            </InputSelect>
            <ValidationMessage For="() => Model.State" class="text-danger" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="form-label">Property Type *</label>
            <InputSelect @bind-Value="Model.PropertyType" class="form-select">
                <option value="">Select property type</option>
                <option value="House">House</option>
                <option value="Apartment">Apartment</option>
                <option value="Condo">Condo</option>
                <option value="Townhouse">Townhouse</option>
                <option value="Duplex">Duplex</option>
                <option value="Commercial">Commercial</option>
                <option value="Other">Other</option>
            </InputSelect>
            <ValidationMessage For="() => Model.PropertyType" class="text-danger" />
        </div>
        <div class="col-md-6 mb-3">
            <label class="form-label">Monthly Rent *</label>
            <InputNumber @bind-Value="Model.MonthlyRent" class="form-control" placeholder="0.00" />
            <ValidationMessage For="() => Model.MonthlyRent" class="text-danger" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="form-label">Status *</label>
            <InputSelect @bind-Value="Model.Status" class="form-select">
                <option value="@ApplicationConstants.PropertyStatuses.Available">Available</option>
                <option value="@ApplicationConstants.PropertyStatuses.ApplicationPending">Application Pending</option>
                <option value="@ApplicationConstants.PropertyStatuses.LeasePending">Lease Pending</option>
                <option value="@ApplicationConstants.PropertyStatuses.Occupied">Occupied</option>
                <option value="@ApplicationConstants.PropertyStatuses.UnderRenovation">Under Renovation</option>
                <option value="@ApplicationConstants.PropertyStatuses.OffMarket">Off Market</option>
            </InputSelect>
            <ValidationMessage For="() => Model.Status" class="text-danger" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-4 mb-3">
            <label class="form-label">Bedrooms</label>
            <InputNumber @bind-Value="Model.Bedrooms" class="form-control" />
            <ValidationMessage For="() => Model.Bedrooms" class="text-danger" />
        </div>
        <div class="col-md-4 mb-3">
            <label class="form-label">Bathrooms</label>
            <InputNumber @bind-Value="Model.Bathrooms" class="form-control" />
            <ValidationMessage For="() => Model.Bathrooms" class="text-danger" />
        </div>
        <div class="col-md-4 mb-3">
            <label class="form-label">Square Feet</label>
            <InputNumber @bind-Value="Model.SquareFeet" class="form-control" />
            <ValidationMessage For="() => Model.SquareFeet" class="text-danger" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 mb-3">
            <label class="form-label">Description</label>
            <InputTextArea @bind-Value="Model.Description" class="form-control" rows="4" placeholder="Property description and features" />
            <ValidationMessage For="() => Model.Description" class="text-danger" />
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 mb-3">
            <div class="form-check">
                <InputCheckbox @bind-Value="Model.IsAvailable" class="form-check-input" />
                <label class="form-check-label">
                    Property is available for rent
                </label>
            </div>
        </div>
    </div>

    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary" disabled="@IsSubmitting">
            @if (IsSubmitting)
            {
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
            }
            @SubmitButtonText
        </button>
        @if (ShowCancelButton)
        {
            <button type="button" class="btn btn-secondary" @onclick="HandleCancel">Cancel</button>
        }
        @if (ShowViewButton && OnView.HasDelegate)
        {
            <button type="button" class="btn btn-outline-primary" @onclick="HandleView">View Property</button>
        }
    </div>
</EditForm>

@code {
    /// <summary>
    /// Form model containing property data
    /// </summary>
    [Parameter, EditorRequired]
    public PropertyFormModel Model { get; set; } = new();
    
    /// <summary>
    /// Form name for SSR scenarios
    /// </summary>
    [Parameter]
    public string FormName { get; set; } = "property-form";
    
    /// <summary>
    /// Text for submit button
    /// </summary>
    [Parameter]
    public string SubmitButtonText { get; set; } = "Save Property";
    
    /// <summary>
    /// Whether form is currently submitting
    /// </summary>
    [Parameter]
    public bool IsSubmitting { get; set; }
    
    /// <summary>
    /// Error message to display
    /// </summary>
    [Parameter]
    public string ErrorMessage { get; set; } = string.Empty;
    
    /// <summary>
    /// Success message to display
    /// </summary>
    [Parameter]
    public string SuccessMessage { get; set; } = string.Empty;
    
    /// <summary>
    /// Whether to show cancel button
    /// </summary>
    [Parameter]
    public bool ShowCancelButton { get; set; } = true;
    
    /// <summary>
    /// Whether to show view button (for edit mode)
    /// </summary>
    [Parameter]
    public bool ShowViewButton { get; set; } = false;
    
    /// <summary>
    /// Callback when form is validly submitted
    /// </summary>
    [Parameter]
    public EventCallback<PropertyFormModel> OnValidSubmit { get; set; }
    
    /// <summary>
    /// Callback when cancel is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnCancel { get; set; }
    
    /// <summary>
    /// Callback when view is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnView { get; set; }
    
    private async Task HandleValidSubmit()
    {
        await OnValidSubmit.InvokeAsync(Model);
    }
    
    private async Task HandleCancel()
    {
        await OnCancel.InvokeAsync();
    }
    
    private async Task HandleView()
    {
        await OnView.InvokeAsync();
    }
}
